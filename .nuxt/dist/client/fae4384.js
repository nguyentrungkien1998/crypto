(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{506:function(t,e,n){"use strict";n.r(e);var r=n(7);n(12),n(73),n(23),n(31),n(48),n(49),n(38),n(30),n(39),n(22),n(40),n(41),n(59);function o(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,f=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return l=t.done,t},e:function(t){f=!0,o=t},f:function(){try{l||null==n.return||n.return()}finally{if(f)throw o}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var l,f,m,d,h,v,w,y,x,_,R={data:function(){return{list:{to:"",limit:6,pager:1,data:[],count:0},multipleSelection:[],mail_show:!1,loadStatus:!0,mail:{content:"",id:null,to:"",from:""}}},computed:{},created:(_=Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.list.to=this.$route.query.email;case 1:case"end":return t.stop()}}),t,this)}))),function(){return _.apply(this,arguments)}),mounted:(x=Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.Reload();case 1:case"end":return t.stop()}}),t,this)}))),function(){return x.apply(this,arguments)}),methods:{waitTime:function(time){return new Promise((function(t){setTimeout((function(){return t(time)}),time)}))},Reload:(y=Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this.GetListMail(),this.CountMail()]);case 2:return this.loadStatus=!1,t.next=5,this.waitTime(1e3);case 5:return t.next=7,this.Reload();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)}))),function(){return y.apply(this,arguments)}),GetListMail:(w=Object(r.a)(regeneratorRuntime.mark((function t(){var e,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.get("/api/mail",{params:{sort:"createdAt DESC",limit:this.list.limit,skip:(this.list.pager-1)*this.list.limit,where:{to:{contains:this.list.to.toLowerCase()}}}});case 2:return e=t.sent,data=e.data,t.abrupt("return",this.list.data=data);case 5:case"end":return t.stop()}}),t,this)}))),function(){return w.apply(this,arguments)}),CountMail:(v=Object(r.a)(regeneratorRuntime.mark((function t(){var e,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.post("/api/mail/count",{to:this.list.to});case 2:return e=t.sent,data=e.data,t.abrupt("return",this.list.count=data.count);case 5:case"end":return t.stop()}}),t,this)}))),function(){return v.apply(this,arguments)}),ConvertTime:function(t){var time=Date.now()-t,e=Math.floor(time/1e3),n=Math.floor(e/60),r=Math.floor(n/60),o=Math.floor(r/24);return o?o+" days":r?r+" hours":n?n+" minutes":e+" seconds"},ChangePagination:(h=Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.loadStatus=!0;case 1:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)}),RemoveMail:(d=Object(r.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.patch("/api/mail/"+e);case 2:return t.sent.data,this.list.data=this.list.data.filter((function(t){return t.id!==e})),t.abrupt("return");case 6:case"end":return t.stop()}}),t,this)}))),function(t){return d.apply(this,arguments)}),handleSelectionChange:function(t){this.multipleSelection=t},OpenStatus:(m=Object(r.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.patch("/api/mail/"+e,{read:!0});case 2:return t.sent.data,this.list.data=this.list.data.map((function(t){return t.id===e&&(t.read=!0),t})),t.abrupt("return");case 6:case"end":return t.stop()}}),t,this)}))),function(t){return m.apply(this,arguments)}),open_mail:(f=Object(r.a)(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.mail=e,this.mail_show=!0,e.read){t.next=5;break}return t.next=5,this.OpenStatus(e.id);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return f.apply(this,arguments)}),remove_mail:(l=Object(r.a)(regeneratorRuntime.mark((function t(){var e,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this,this.$confirm("Bạn chắn chắn muốn thực hiện hành động này ?","Xác nhận",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning",center:!1}).then(Object(r.a)(regeneratorRuntime.mark((function t(){var r,c,l,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.multipleSelection.length,c=o(e.multipleSelection),t.prev=2,c.s();case 4:if((l=c.n()).done){t.next=10;break}return f=l.value.id,t.next=8,n.RemoveMail(f);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),c.e(t.t0);case 15:return t.prev=15,c.f(),t.finish(15);case 18:n.$message({type:"error",message:"Đã xoá "+r+" email"});case 19:case"end":return t.stop()}}),t,null,[[2,12,15,18]])})))).catch(Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))));case 2:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)})},asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$axios,e.next=3,n.$get("/api/config");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))()}},k=n(47),component=Object(k.a)(R,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:16,offset:0}},[n("el-tag",{attrs:{type:"primary",closable:!1,effect:"plain",size:"large","disable-transitions":!1}},[n("i",{staticClass:"el-icon-message"}),t._v(" "+t._s(t.list.count)+" email")]),t._v(" "),t.multipleSelection.length>0?n("el-button",{attrs:{type:"danger",icon:"el-icon-delete-solid",loading:!1,plain:!1,round:!1,circle:!1,autofocus:!1,size:"small",disabled:!1},on:{click:t.remove_mail}},[t._v("Remove "),t.multipleSelection.length>0?n("span",[t._v(t._s(t.multipleSelection.length)+" items")]):t._e()]):t._e()],1),t._v(" "),n("el-col",{attrs:{span:6,offset:0}},[n("el-input",{attrs:{placeholder:"Type your Email",size:"medium","prefix-icon":"",type:"text",autosize:!1,disabled:!1,autocomplete:"off"},model:{value:t.list.to,callback:function(e){t.$set(t.list,"to",e)},expression:"list.to"}})],1),t._v(" "),n("el-col",{attrs:{span:2,offset:0}},[n("el-button",{attrs:{type:"primary",icon:"el-icon-search",loading:!1,plain:!1,round:!1,circle:!1,autofocus:!1,size:"medium",disabled:!1}})],1)],1),t._v(" "),n("el-divider",{attrs:{direction:"horizontal"}}),t._v(" "),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:24,offset:0}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadStatus,expression:"loadStatus"}],staticStyle:{width:"100%"},attrs:{data:t.list.data,border:!1,"highlight-current-row":!0,stripe:!1,lazy:!1,"show-summary":!1,"tooltip-effect":"light"},on:{"selection-change":t.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),n("el-table-column",{attrs:{label:"From",prop:"from",align:"left",sortable:!1,fixed:!1,width:"400"}}),t._v(" "),n("el-table-column",{attrs:{label:"To",prop:"to",align:"left",sortable:!1,fixed:!1,width:"300"}}),t._v(" "),n("el-table-column",{attrs:{label:"Time",align:"center",width:"400"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tag",{attrs:{type:"danger",closable:!1,effect:"dark",size:"medium","disable-transitions":!1}},[t._v(t._s(t.ConvertTime(e.row.createdAt))+" ago")])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"",align:"center",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.read?t._e():n("el-button",{attrs:{type:"success",icon:"el-icon-message",loading:!1,plain:!1,round:!1,circle:!1,autofocus:!1,size:"medium",disabled:!1},on:{click:function(n){return t.open_mail(e.row)}}},[t._v("Open Message")]),t._v(" "),e.row.read?n("el-button",{attrs:{type:"success",icon:"el-icon-view",loading:!1,plain:!0,round:!1,circle:!1,autofocus:!1,size:"medium",disabled:!1},on:{click:function(n){return t.open_mail(e.row)}}},[t._v("Read Message")]):t._e()]}}])})],1)],1)],1),t._v(" "),n("br"),n("br"),t._v(" "),n("el-pagination",{attrs:{total:t.list.count,"current-page":t.list.pager,"pager-count":11,"hide-on-single-page":!1,background:"",layout:"prev, pager, next"},on:{"current-change":t.ChangePagination,"update:currentPage":function(e){return t.$set(t.list,"pager",e)},"update:current-page":function(e){return t.$set(t.list,"pager",e)}}}),t._v(" "),n("el-dialog",{attrs:{title:t.mail.from,visible:t.mail_show,center:!1,fullscreen:!1,top:"0vh",width:"50%"},on:{"update:visible":function(e){t.mail_show=e}}},[n("div",{domProps:{innerHTML:t._s(t.mail.content)}})])],1)}),[],!1,null,"58c7ea2a",null);e.default=component.exports}}]);